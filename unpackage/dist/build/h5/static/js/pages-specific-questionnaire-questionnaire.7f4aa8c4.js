(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-specific-questionnaire-questionnaire"],{"01c2":function(t,e,i){"use strict";var a=i("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("a481"),i("28a5"),i("96cf");var n=a(i("3b8d")),o=a(i("a4bb"));i("ac6a");var s=a(i("a745")),r=a(i("2cd2")),c=i("a572"),l={name:"questionnaire",components:{bxform:r.default},data:function(){return{formType:"form",activity_no:"",status:"未开始",configCols:[],formData:{title:"",remark:"",end_remark:""},userInfo:{},wxUserInfo:{},questionData:{},fill_batch_no:""}},methods:{seeReport:function(){var t=this.getServiceUrl("daq","srvdaq_activity_sug_select","select"),e={serviceName:"srvdaq_activity_sug_select",colNames:["*"],condition:[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"fill_batch_no",ruleType:"eq",value:this.fill_batch_no}]};this.$http.post(t,e).then(function(t){console.log(t.data)})},toCreate:function(){uni.redirectTo({url:"/pages/specific/home/home"})},toFeedback:function(){uni.redirectTo({url:"/pages/specific/questionnaire/questionnaire?formType=form&activity_no=20200309125000000100&status=进行中"})},saveValue:function(t){var e=this;if(console.log("saveValue",t,this.status),t.value&&"进行中"===this.status){var i=[{item_no:t.column,option_data:[t.value]}];"checkbox"===t.type&&(i=[{item_no:t.column,option_data:t.value}]),(0,s.default)(t.value)&&(i=[{item_no:t.column,option_data:t.value}]);var a="srvdaq_activity_result_save",n=this.getServiceUrl("daq",a,"operate"),o=[{serviceName:a,data:[{activity_no:this.activity_no,item_data:i}]}];this.fill_batch_no&&(o[0].data[0].fill_batch_no=this.fill_batch_no),this.$http.post(n,o).then(function(t){if("SUCCESS"===t.data.state){if("SUCCESS"===t.data.resultCode){console.log(t.data.response[0].response);var i=t.data.response[0].response;i.fill_batch_no&&!e.fill_batch_no&&(e.fill_batch_no=i.fill_batch_no)}}else console.log(t)})}},submitForm:function(){var t=this;uni.showModal({title:"提示",content:"确认提交问卷?",success:function(e){if(e.confirm)if("进行中"!==t.status)uni.showToast({title:"状态非进行中的问卷不支持提交",icon:"none"});else{var i=t.$refs.bxform.getFieldModel();console.log("itemData",i);var a=[];(0,o.default)(i).forEach(function(t){var e={item_no:t,option_data:[i[t]]};(0,s.default)(i[t])&&(e.option_data=i[t]),i[t]&&a.push(e)});var n="srvdaq_activity_result_submit",r=t.getServiceUrl("daq",n,"operate"),c=[{serviceName:n,data:[{fill_batch_no:t.fill_batch_no,activity_no:t.activity_no,item_data:a}]}];console.log("resultData",a),t.$http.post(r,c).then(function(t){"SUCCESS"===t.data.state?"SUCCESS"===t.data.resultCode&&(uni.showToast({title:"提交成功",icon:"none"}),uni.redirectTo({url:"../home/home"})):("FAILURE"===t.data.resultCode&&uni.showToast({title:t.data.resultMessage,icon:"none"}),console.log(t))})}else e.cancel&&console.log("用户点击取消")}})},getQuestionnaireData:function(t){var e=this;uni.showLoading({mask:!0});var i="srvdaq_init_view_select",a=this.getServiceUrl("daq",i,"select"),n={serviceName:i,colNames:["*"],order:[{colName:"item_seq",orderType:"asc"}],condition:[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"type",ruleType:"eq",value:"use"}]};"未开始"===this.status&&(n.condition=[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"biz_type",ruleType:"eq",value:"cfg"}]),console.log(this.questionData),t&&t.fill_batch_no&&(n.condition=[{colName:"activity_no",ruleType:"eq",value:t.activity_no},{colName:"type",ruleType:"eq",value:"use"},{colName:"fill_batch_no",ruleType:"eq",value:t.fill_batch_no}]),this.activity_no&&this.fill_batch_no&&(n.condition=[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"type",ruleType:"eq",value:"use"},{colName:"fill_batch_no",ruleType:"eq",value:this.fill_batch_no}]),this&&this.$http.post(a,n).then(function(t){if(uni.hideLoading(),"SUCCESS"===t.data.state){var i=t.data.data[0];e.activity_no=i.activity_no;var a=[];i.item_data.forEach(function(t){a.push(e.getConfig(t))}),i.logo&&e.getPicture(i.logo).then(function(t){e.$set(e.formData,"fileUrl",t)}),i.user_data&&"多次"!==i.answer_times&&(console.log("data.answer_times",i.answer_times),a.forEach(function(t){"detail"===e.formType&&(t.disabled=!0),i.user_data.forEach(function(e){t.column===e.item_no&&(t.item_type_attr&&"multi"===t.item_type_attr.radioType?(t.value=e.option_data,console.log("items.option_data",e.option_data)):(console.log("item_type",t),t.value=e.option_data[0]))})})),e.formData=i,e.configCols=a,e.getUserInfo()}else"0011"===t.data.resultCode?uni.showToast({title:"未登录",icon:"none"}):"FAILURE"===t.data.resultCode&&(uni.showToast({title:t.data.resultMessage,icon:"none"}),"活动已结束"===t.data.resultMessage&&e.updateState().then(function(e){uni.showModal({title:"提示",content:t.data.resultMessage+",即将跳转到列表页面",showCancel:!1,success:function(t){t.confirm&&uni.navigateBack({animationDuration:2e3})}})}))}).catch(function(t){console.log("err",t),uni.hideLoading()})},updateState:function(){var t=(0,n.default)(regeneratorRuntime.mark(function t(e){var i,a,n,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i=[{status:"已结束"}],a=this.getServiceUrl("daq","srvdaq_activity_cfg_update","operate"),n=[{serviceName:"srvdaq_activity_cfg_update",data:i,condition:[{colName:"activity_no",ruleType:"eq",value:this.activity_no}]}],t.next=5,this.$http.post(a,n);case 5:return o=t.sent,o.data.resultCode,t.abrupt("return",o);case 9:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getUserInfo:function(){var t=(0,n.default)(regeneratorRuntime.mark(function t(){var e,i,a,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.$api.getUserInfo,i={serviceName:"srvwx_basic_user_info_select",colNames:["*"],condition:[{colName:"app_no",ruleType:"eq",value:this.$api.appNo.wxh5}]},t.next=4,this.$http.post(e,i);case 4:a=t.sent,"SUCCESS"===a.data.state&&a.data.data.length>0?(n=a.data.data[0],this.wxUserInfo=n,uni.setStorageSync("wxUserInfo",n)):uni.showToast({title:"未获取到当前微信用户信息",icon:"none"}),this.getSignature();case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getPicture:function(){var t=(0,n.default)(regeneratorRuntime.mark(function t(e){var i,a,n,o,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i="srvfile_attachment_select",a=this.getServiceUrl("file",i,"select"),n={serviceName:i,colNames:["*"],condition:[{colName:"file_no",value:e,ruleType:"eq"}]},null===e||""===e||void 0===e){t.next=12;break}return t.next=6,this.$http.post(a,n);case 6:if(o=t.sent,"SUCCESS"!==o.data.state){t.next=12;break}if(s=o.data.data[0],!s){t.next=12;break}return r=this.$api.srvHost+"/file/download?filePath="+s.fileurl,t.abrupt("return",r);case 12:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getConfig:function(t){var e={label:t.item_title,column:t.item_no,srvInfo:{serviceName:"srvdaq_activity_result_submit",appNo:"daq"},value:t.value,type:t.item_type,isRequire:"是"===t.is_require,isShowExp:[],options:[],item_type_attr:t.item_type_attr,display:!0};switch("detail"===this.formType&&(e.disabled=!0),t.item_type){case"文本":e.type="textarea"===t.item_type_attr["view_model"]?"textarea":"input";break;case"图片":e.type="images",e["fileNum"]=t.item_type_attr["fileNum"];break;case"选项":e.type=t.item_type_attr.radioType&&"multi"===t.item_type_attr.radioType?"checkbox":"radio",e.options=t.option_data.map(function(t){return t.option_value});break;case"时间日期":e.type=t.item_type_attr.dateType?t.item_type_attr.dateType:"dateTime";break;case"数字":e.type=t.item_type_attr.numberType?t.item_type_attr.numberType:"number";break;default:e.type=t.item_type;break}return e},saveShareRecord:function(t){var e=this.$api.saveShareRecord,i=[{serviceName:"srvdaq_record_share_add",data:[{biz_no:this.activity_no,biz_type:"daq",share_url:window.location.href,from_user:this.userInfo.user_no,share_type:t||"朋友圈"}]}];this.$http.post(e,i).then(function(t){console.log(t)})},getSignature:function(t){var e=this,i=window.location.href.split("#")[0],a={serviceName:"srvwx_app_signature_select",colNames:["*"],condition:[{colName:"app_no",ruleType:"eq",value:this.$api.appNo.wxh5},{colName:"page_url",ruleType:"eq",value:uni.getStorageSync("linkUrl")?uni.getStorageSync("linkUrl"):window.location.href.split("#")[0]}]};uni.getStorageSync("linkUrl")&&console.log("linkUrl",uni.getStorageSync("linkUrl")),uni.setStorageSync("linkUrl",null),e.$http.post(e.$api.getSignature,a).then(function(t){if("SUCCESS"===t.data.state){var a=t.data.data[0];console.log("getSignature",a),uni.setStorageSync("signatureInfo",a),c.config({debug:!1,appId:a.appId,timestamp:a.timestamp,nonceStr:a.noncestr,signature:a.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData","onMenuShareTimeline","onMenuShareAppMessage"]}),c.ready(function(){console.log("wx.ready()",e.wxUserInfo),i=i.replace(/formType=detail/,"formType=form"),c.updateAppMessageShareData({imgUrl:e.wxUserInfo.headimgurl?e.wxUserInfo.headimgurl:e.formData.fileUrl?e.formData.fileUrl:"https://srvms.100xsys.cn:443/file/download?fileNo=20200306184125960100",desc:e.formData.summary,title:e.formData.title,link:i,success:function(){e.saveShareRecord("朋友")},cancel:function(){}}),c.updateTimelineShareData({imgUrl:e.wxUserInfo.headimgurl?e.wxUserInfo.headimgurl:e.formData.fileUrl?e.formData.fileUrl:"https://srvms.100xsys.cn:443/file/download?fileNo=20200306184125960100",desc:e.formData.summary,title:e.formData.title,link:i,success:function(){e.saveShareRecord("朋友圈")},cancel:function(){}})}),c.error(function(t){console.log(t)})}})},getParams:function(t){var e=window.location.href;e=e.split("?")[1];var i=e.split("&"),a={};return i.forEach(function(t){a[t.split("=")[0]]=t.split("=")[1]}),!!a[t]&&a[t]}},mounted:function(){},onShow:function(){},created:function(){},onLoad:function(t){t.formType&&"detail"===t.formType?this.formType=t.formType:this.formType="form",t.fill_batch_no&&(this.fill_batch_no=t.fill_batch_no);var e=t.questionData;e&&(e=JSON.parse(decodeURIComponent(t.questionData))),e&&e.fill_batch_no?(this.formType="detail",this.questionData=e,this.getQuestionnaireData(this.questionData)):(t.status&&(this.status=decodeURIComponent(t.status),console.log("status",this.status)),t.activity_no?(this.activity_no=t.activity_no,this.getQuestionnaireData()):this.questionData.activity_no?(this.status="已完成",this.activity_no=this.questionData.activity_no,this.getQuestionnaireData()):uni.showModal({title:"提示",content:"未知的问卷编号，即将跳转到问卷列表",showCancel:!1,success:function(t){t.confirm&&uni.reLaunch({url:"/pages/specific/home/home"})}}))}};e.default=l},"4a0f":function(t,e,i){"use strict";var a=i("a908"),n=i.n(a);n.a},"7a11":function(t,e,i){"use strict";i.r(e);var a=i("01c2"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);e["default"]=n.a},a908:function(t,e,i){var a=i("ac16");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("c4e6162e",a,!0,{sourceMap:!1,shadowMode:!1})},ac16:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.question-title[data-v-66c45e8d]{height:%?100?%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:#333;font-weight:600;font-size:18px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.footer-button[data-v-66c45e8d]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.footer-button .foot-btn[data-v-66c45e8d]{height:%?40?%;line-height:%?40?%;border-bottom:1px solid #fff}.qrcode-box[data-v-66c45e8d]{display:-webkit-box;display:-webkit-flex;display:flex;width:100%;padding:%?50?% 0;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.qrcode-box .qrcode[data-v-66c45e8d]{width:%?400?%;height:%?400?%;padding:%?10?%;background-color:#fff;border-radius:%?10?%}.qrcode-box .contact[data-v-66c45e8d]{height:%?50?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.qrcode-box .foot-words[data-v-66c45e8d]{display:-webkit-box;display:-webkit-flex;display:flex;font-size:%?24?%;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center;line-height:%?50?%}.text-content-text[data-v-66c45e8d]{width:100%;min-height:%?200?%;height:auto;margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;font-size:%?34?%;line-height:%?60?%}',""])},d46b:function(t,e,i){"use strict";i.r(e);var a=i("f8ec"),n=i("7a11");for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);i("4a0f");var s,r=i("f0c5"),c=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"66c45e8d",null,!1,a["a"],s);e["default"]=c.exports},f8ec:function(t,e,i){"use strict";var a,n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"cu-card article bg-blue",staticStyle:{"min-height":"100vh"}},[i("v-uni-view",{staticClass:"cu-item shadow",staticStyle:{padding:"10upx"}},[i("v-uni-view",{staticClass:"question-title"},[i("v-uni-view",{staticClass:"text-cut"},[t._v(t._s(t.formData.title))])],1),i("v-uni-view",{staticClass:"content",staticStyle:{padding:"0 30upx"}},[i("v-uni-view",{staticClass:"desc"},[i("v-uni-view",{staticClass:"text-content-text text-black"},[i("v-uni-view",{domProps:{innerHTML:t._s(JSON.parse(JSON.stringify(t.formData.remark).replace(/\<img/gi,"<img width=100% height=100%   ")))}})],1),i("v-uni-view",{staticStyle:{"margin-top":".5rem"}},[t.formData.start_time?i("v-uni-view",{staticClass:"text-blue"},[t._v("开始时间："+t._s(t.formData.start_time.slice(0,10)))]):t._e(),t.formData.end_time?i("v-uni-view",{staticClass:"text-blue"},[t._v("结束时间："+t._s(t.formData.end_time.slice(0,10)))]):t._e()],1)],1)],1),i("v-uni-view",{staticClass:"content",staticStyle:{padding:"20upx 0","box-sizing":"border-box"}},[i("bxform",{ref:"bxform",attrs:{fields:t.configCols,BxformType:"form",pageType:"add"},on:{"value-blur":function(e){arguments[0]=e=t.$handleEvent(e),t.saveValue.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"content",staticStyle:{padding:"0 30upx"}},[i("v-uni-view",{staticClass:"desc"},[i("v-uni-view",{staticClass:"text-content-text"},[i("v-uni-view",{domProps:{innerHTML:t._s(JSON.parse(JSON.stringify(t.formData.end_remark).replace(/\<img/gi,"<img width=100% height=100% ")))}})],1)],1)],1),"form"===t.formType&&t.configCols&&t.configCols.length>0?i("v-uni-view",{staticClass:"button-box",staticStyle:{margin:"30upx"}},[i("v-uni-button",{staticClass:"bg-blue line-white",attrs:{type:""},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitForm("submit")}}},[t._v("提交")])],1):t._e(),"detail"===t.formType&&t.configCols&&t.configCols.length>0&&"评估"===t.formData.info_collect_type?i("v-uni-view",{staticClass:"button-box",staticStyle:{margin:"30upx"}},[i("v-uni-button",{staticClass:"bg-blue line-white",attrs:{type:""},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.seeReport()}}},[t._v("查看评估结果")])],1):t._e()],1),t.configCols&&t.configCols.length>0?i("v-uni-view",{staticClass:"footer-button"},[i("v-uni-view",{staticClass:"foot-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toCreate.apply(void 0,arguments)}}},[t._v("我要创建")]),"20200309125000000100"!==t.activity_no?i("v-uni-view",{staticClass:"foot-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toFeedback.apply(void 0,arguments)}}},[t._v("意见反馈")]):t._e()],1):t._e(),i("v-uni-view",{staticClass:"qrcode-box",staticStyle:{"text-align":"center","margin-bottom":"30upx"}},[i("v-uni-view",{staticClass:"contact"},[t._v("为了及时获取最新信息")]),i("v-uni-view",{staticClass:"contact"},[t._v("长按下方二维码 识别关注公众号")]),i("v-uni-view",{staticStyle:{display:"flex","margin-bottom":"20upx"}},[i("v-uni-text",{staticClass:"cuIcon-refresharrow"}),i("v-uni-text",{staticClass:"cuIcon-refresharrow"})],1),i("v-uni-image",{staticClass:"qrcode",attrs:{src:"../../../static/code.png",mode:""}}),i("v-uni-view",{staticClass:"foot-words",staticStyle:{"margin-top":"10upx"}},[t._v("百想科技")]),i("v-uni-view",{staticClass:"foot-words"},[t._v("进入公众号后")]),i("v-uni-view",{staticClass:"foot-words"},[t._v("点击下方“信息采集”按钮")]),i("v-uni-view",{staticClass:"foot-words"},[t._v("即可进入问卷列表")])],1)],1)},o=[];i.d(e,"b",function(){return n}),i.d(e,"c",function(){return o}),i.d(e,"a",function(){return a})}}]);