(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-specific-activityUpdate-activityUpdate"],{"1f96":function(e,t,i){"use strict";i.r(t);var a=i("c7c8"),n=i.n(a);for(var o in a)"default"!==o&&function(e){i.d(t,e,function(){return a[e]})}(o);t["default"]=n.a},6084:function(e,t,i){"use strict";var a=i("df45"),n=i.n(a);n.a},b1d0:function(e,t,i){"use strict";var a,n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[i("cu-custom",{attrs:{bgColor:"bg-blue",isBack:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"},[e._v("返回")]),i("template",{attrs:{slot:"content"},slot:"content"},[e._v("活动问题编辑")])],2),i("v-uni-view",{staticClass:"cu-card article"},[i("v-uni-view",{staticClass:"cu-item shadow"},[i("v-uni-view",{staticClass:"title"},[i("v-uni-view",{staticClass:"text-cut"},[e._v(e._s(e.activityData.title))])],1),i("v-uni-view",{staticClass:"content"},[i("v-uni-view",{staticClass:"desc"},[i("v-uni-view",{staticClass:"text-content",domProps:{innerHTML:e._s(JSON.parse(JSON.stringify(e.activityData.remark).replace(/\<img/gi,"<img width=100% height=100%   ")))}})],1)],1)],1)],1),i("v-uni-view",{staticClass:"cu-bar bg-white solid-bottom margin-top"},[i("v-uni-view",{staticClass:"action"},[i("v-uni-text",{staticClass:"cuIcon-titles text-orange "}),e._v("已设置的问题：")],1)],1),i("v-uni-view",{staticClass:"cu-card article"},[i("v-uni-view",{staticClass:"cu-item shadow"},[e.viewCfg.length>0?i("bxform",{ref:"bxformActivity",attrs:{pageType:e.activityFormType,fields:e.viewCfg,BxformType:e.activityFormType},on:{"on-form-item":function(t){arguments[0]=t=e.$handleEvent(t),e.onFieldsItem.apply(void 0,arguments)}}}):e._e(),i("v-uni-view",{staticStyle:{width:"100%",height:"100upx",opacity:"0"}},[e._v("底部占位盒子")])],1)],1),i("v-uni-view",{staticClass:"cu-bar tabbar bg-white foot"},[i("v-uni-view",{staticClass:"action text-green",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.toadded.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cuIcon-settingsfill"}),e._v("设置活动")],1),i("v-uni-view",{staticClass:"action text-gray",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showReview.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cuIcon-attentionfill"},[i("v-uni-view",{staticClass:" badge"})],1),e._v("预览")],1),i("v-uni-view",{staticClass:"action text-gray add-action"},[i("v-uni-button",{staticClass:"cu-btn cuIcon-add bg-green shadow",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showAdd.apply(void 0,arguments)}}}),e._v("添加问题")],1)],1),i("v-uni-view",{staticClass:"cu-modal bottom-modal",class:e.showModal?"show":""},[i("v-uni-view",{staticClass:"cu-dialog",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t)}}},[e.configCols.length>0?i("v-uni-view",{staticClass:"cu-modal-content"},[i("bxform",{key:e.showAddForm,ref:"bxformAddQuestion",attrs:{pageType:e.itemFormType,fields:e.itemModel,BxformType:e.itemFormType},on:{"value-blur":function(t){arguments[0]=t=e.$handleEvent(t),e.valueChange.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"cu-bar btn-group"},[i("v-uni-button",{staticClass:"cu-btn bg-grey shadow-blur round",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hideModal.apply(void 0,arguments)}}},[e._v("取消")]),"选项"!==e.questionType||e.configCols[0].value?e._e():i("v-uni-button",{staticClass:"cu-btn bg-green shadow-blur round",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addItem("save")}}},[e._v("保存问题")]),"选项"===e.questionType&&e.configCols[0].value?i("v-uni-button",{staticClass:"cu-btn bg-blue shadow-blur round",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hideModal("refresh")}}},[e._v("完成")]):e._e(),"选项"!==e.questionType?i("v-uni-button",{staticClass:"cu-btn bg-blue shadow-blur round",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addItem.apply(void 0,arguments)}}},[e._v("提交")]):e._e()],1)],1):e._e()],1)],1)],1)},o=[];i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"a",function(){return a})},c7c8:function(e,t,i){"use strict";var a=i("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(i("f499"));i("55dd"),i("96cf");var o=a(i("3b8d")),s={components:{bxform:function(e){return Promise.all([i.e("chunk-1c6e6260"),i.e("chunk-41ff2ec0")]).then(i.bind(null,"2cd2"))}},data:function(){return{activityFormType:"form",itemFormType:"add",viewCfg:[],maxSeq:1,question_no:"",isQuestion:!1,questionType:"文本",activityNo:null,activityData:{activity_no:"",title:"",end_time:"",remark:"",end_remark:""},showModal:!1,showAddForm:!0,configCols:[{label:"问题编号",column:"item_no",disabled:!0,value:"",type:"input",display:!1,isRequire:!1,isShowExp:[{colName:"item_type",ruleType:"eq",value:"null"}],options:[]},{label:"问题类型",column:"item_type",value:"文本",type:"radio",display:!0,isRequire:!0,isShowExp:"",options:["文本","数字","选项","图片","时间日期"]},{label:"名称",column:"item_title",value:"",type:"input",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"neq",value:""}],options:[]},{label:"选项列表",column:"options_list",value:"",type:"list",display:!0,isRequire:!1,isShowExp:[{colName:"item_type",ruleType:"eq",value:"选项"},{colName:"item_no",ruleType:"neq",value:""}],optionsConfig:{selectServiceName:"srvdaq_option_cfg_select",addServiceName:"srvdaq_option_cfg_add",deleteServiceName:"srvdaq_option_cfg_delete",updateServiceName:"srvdaq_option_cfg_update",appNo:"daq",conditions:[{colName:"item_no",ruleType:"eq",value:"item_no"}],key_col:{refed_col:"id",key_disp_col:"option_value",value:"option_value",no:"option_seq"},model:{item_no:"",option_value:"",option_seq:""}},options:[]},{label:"选项类型",column:"option_type",value:"单选",type:"radioFk",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"选项"}],options:[{label:"单选",value:"单选"},{label:"多选",value:"多选"}]},{label:"是否必填",column:"is_require",value:"是",type:"radio",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"neq",value:""}],options:["是","否"]},{label:"行数",column:"view_model",value:"input",type:"radioFk",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"文本"}],options:[{value:"input",label:"单行"},{value:"textarea",label:"多行"}]},{label:"最大字数",column:"max_len",value:50,type:"number",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"文本"}],options:[]},{label:"数字精度",column:"decimal_places",value:"Int",type:"radioFk",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"数字"}],options:[{value:"number",label:"整数"},{value:"digit",label:"小数"}]},{label:"数字最大值",column:"max",value:100,type:"number",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"数字"}],options:[]},{label:"数字最小值",column:"min",value:0,type:"number",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"数字"}],options:[]},{label:"时间类型",column:"format",value:"date",type:"radioFk",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"时间日期"}],options:[{value:"dateTime",label:"年月日时分秒"},{value:"date",label:"年月日"},{value:"time",label:"时分秒"}]},{label:"图片数量",column:"max_num",value:3,type:"number",display:!0,isRequire:!0,isShowExp:[{colName:"item_type",ruleType:"eq",value:"图片"}],options:[]}],inputBut:[{name:"上移",key:"up",icon:"cuIcon-top"},{name:"下移",key:"down",icon:"cuIcon-down"},{name:"编辑",key:"edit",icon:"cuIcon-edit"},{name:"删除",key:"delete",color:"red",icon:"cuIcon-deletefill"}]}},onLoad:function(){this.$route.query.hasOwnProperty("activity_no")&&(this.activityNo=this.$route.query.activity_no,this.getActivityInfo(this.activityNo))},computed:{itemModel:{get:function(){return this.configCols},set:function(e){this.configCols=this.configCols.map(function(t,i){return t.column===e.col&&(t.value=e.val,console.log("computed---itemModel:",e)),"options_list"===t.column&&(t["options"]=[]),t})}}},methods:{valueChange:function(e){console.log("value-change",e),e.column&&"item_type"===e.column&&(this.questionType=e.value,this.showAddForm=!this.showAddForm)},onFieldsItem:function(e){var t=this;console.log(e);for(var i=e.item,a=this.viewCfg,n=null,o=null,s=null,l=0;l<a.length;l++)i.column===a[l]["column"]&&(n=l);var u=new Array(2);switch(e.button.key){case"up":o=n-1,console.log("upIndex",o),u[0]=a[o],u[1]=a[n];break;case"down":s=n+1,console.log("downIndex",s),u[0]=a[n],u[1]=a[s];break;case"delete":break;default:break}if("up"!==e.button.key||2!==u.length||u[0])if("down"!==e.button.key||2!==u.length||u[1])if("up"===e.button.key||"down"===e.button.key){var c=u.map(function(e){return e.seq});u[0]["seq"]=c[1],u[1]["seq"]=c[0],uni.showLoading({mask:!0}),this.updateQuestion(u[0]).then(function(e){t.updateQuestion(u[1]).then(function(e){t.viewCfg=[],t.viewCfg.length=0,t.getActivityInfo(t.activityNo),uni.hideLoading()})})}else"delete"===e.button.key?(uni.showLoading({mask:!0}),this.deleteQuestion(i)):"edit"===e.button.key&&(this.isQuestion=!0,console.log("编辑 updates",a[n],this.configCols),this.question_no=e.item.column,this.updateQuestions(a[n]));else uni.showToast({title:"此问题已排在最末",icon:"none"});else uni.showToast({title:"此问题已排在最前",icon:"none"});console.log("需要编辑的列",u,n,this.configCols)},deleteQuestion:function(e){var t=this;uni.showModal({title:"提示",content:"确认删除此问题？",success:function(i){if(i.confirm){var a=t.getServiceUrl("daq","srvdaq_item_cfg_delete","delete"),n=[{serviceName:"srvdaq_item_cfg_delete",condition:[{colName:"item_no",ruleType:"eq",value:e.column}]}];t.$http.post(a,n).then(function(e){"SUCCESS"===e.data.resultCode?(uni.showToast({title:"删除成功",icon:"none"}),t.getActivityInfo(t.activityNo),uni.hideLoading()):uni.showToast({title:"删除失败",icon:"none"})})}else uni.showToast({title:"取消删除",icon:"none"})}})},updateQuestions:function(){var e=(0,o.default)(regeneratorRuntime.mark(function e(t){var i,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.showAddForm=!this.showAddForm,i=t,a=t.item_type_attr,console.log("字段额外属性",a),this.configCols=this.configCols.map(function(e,t){switch(e.column){case"item_no":return e.value=i.column,e;case"item_type":switch(i.type){case"number":e.value="数字";break;case"input":e.value="文本";break;case"radio":e.value="选项";break;case"checkbox":e.value="选项";break;case"images":e.value="图片";break;case"date":e.value="时间日期";break;case"time":e.value="时间日期";break;case"dateTime":e.value="时间日期";break;default:break}return e;case"item_title":return e.value=i.label,e;case"option_type":return e.value="single"===a.radioType?"单选":"multi"===a.radioType?"多选":"",e;case"is_require":return e.value=!0===i.isRequire?"是":"否",e;case"max_len":return e.value=a.max_len,e;case"decimal_places":return e.value=a.decimal_places,e;case"max":return e.value=a.max,e;case"view_model":return e.value=a.view_model,"单行"===e.value?e.value="input":e.value="textarea",e;case"options_list":return e.options=i._rawData.option_data,e;case"min":return e.value=a.min,e;case"format":return e.value=a.dateType,e;case"max_num":return e.value=a.max_num,e;default:break}return e}),this.showModal=!0;case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),updateQuestion:function(){var e=(0,o.default)(regeneratorRuntime.mark(function e(t){var i,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this.getServiceUrl("daq","srvdaq_item_cfg_update","update"),a=[{serviceName:"srvdaq_item_cfg_update",condition:[{colName:"item_no",ruleType:"eq",value:t.column}],data:[{item_seq:t.seq}]}],e.next=4,this.$http.post(i,a);case 4:return n=e.sent,e.abrupt("return","SUCCESS"===n.data.resultCode);case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),showReview:function(){uni.redirectTo({url:"/pages/specific/questionnaire/questionnaire?formType=detail&activity_no="+this.activityNo})},getActivityInfo:function(){var e=(0,o.default)(regeneratorRuntime.mark(function e(t){var i,a,n,o,s,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this,a=this.getServiceUrl("daq","srvdaq_init_view_select","select"),n={serviceName:"srvdaq_init_view_select",condition:[{colName:"activity_no",ruleType:"eq",value:t},{colName:"biz_type",ruleType:"eq",value:"cfg"}]},e.next=5,this.$http.post(a,n);case 5:o=e.sent,console.log("srvdaq_init_view_select",o),"SUCCESS"===o.data.state&&o.data.data.length>0&&(i.activityData=o.data.data[0],i.viewCfg=o.data.data[0].item_data,s=i.viewCfg.map(function(e){return e.item_seq}),i.maxSeq=s.sort()[s.length-1],i.viewCfg=this.viewCfg.map(function(e){return l.getConfig(e)}),i.viewCfg=i.arraySort(i.viewCfg,"seq"));case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),addItem:function(){var e=(0,o.default)(regeneratorRuntime.mark(function e(t){var i,a,n,o,s,l,u,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=this,a=this.$refs.bxformAddQuestion.getFieldModel(),console.log("itemData",a),this.showAddForm=!this.showAddForm,n=this.getServiceUrl("daq","srvdaq_item_cfg_add","add"),o=[{serviceName:"srvdaq_item_cfg_add",data:[]}],this.isQuestion&&(n=this.getServiceUrl("daq","srvdaq_item_cfg_update","operate"),o=[{serviceName:"srvdaq_item_cfg_update",condition:[{colName:"item_no",ruleType:"eq",value:this.question_no}],data:[]}]),!a){e.next=22;break}return s=this.getCoulmnConfig(a),console.log("newInput",s),s.activity_no=this.activityNo,this.isQuestion||(l=this.viewCfg.map(function(e){return e.seq}).filter(function(e){return e&&e}).sort(),s["item_seq"]=l&&l.length>0?l[l.length-1]+1:1),console.log("newInput",s),o[0].data.push(s),e.next=16,this.$http.post(n,o);case 16:u=e.sent,console.log("srvdaq_item_cfg_add",u),"SUCCESS"===u.data.state&&u.data.response.length>0&&(i.getActivityInfo(i.activityNo),t&&"save"===t&&(c=u.data.response[0].response.effect_data[0].item_no,console.log("question_no",c),i.configCols=i.configCols.map(function(e,t){return"item_no"===e.column&&(e.value=c),e}))),"save"!==t?i.hideModal():this.isQuestion=!0,e.next=23;break;case 22:console.log("表单填写不完整");case 23:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),DateChange:function(e){this.date=e.detail.value},toUpdate:function(){uni.redirectTo({url:"/pages/specific/activityUpdate/activityUpdate?id=1"})},toadded:function(){uni.redirectTo({url:"/pages/specific/added/added?activity_no="+this.activityNo+"&serviceName=srvdaq_activity_cfg_add&type=update"})},activeFc:function(e){uni.showToast({title:"获取输入成功"}),console.log((0,n.default)(e))},showAdd:function(e){this.isQuestion=!1,this.showModal=!0},hideModal:function(e){"refresh"===e&&this.getActivityInfo(this.activityNo),this.configCols.map(function(e){"问题类型"===e.label?e.value="文本":e.value=""}),this.showAddForm=!this.showAddForm,this.showModal=!1},getConfig:function(e){var t={label:e.item_title,column:e.item_no,srvInfo:{serviceName:"srvdaq_activity_result_submit",appNo:"daq"},value:e.value,type:e.item_type,isRequire:"是"===e.is_require,isShowExp:[],options:[],seq:e.item_seq,display:!0,item_type_attr:e.item_type_attr,buttons:[],_rawData:e};switch(t.buttons=this.inputBut,e.option_data&&"选项"===e.item_type&&(t.options=e.option_data.map(function(e){return e.option_value})),"图片"===e.item_type&&(t["fileNum"]=e.item_type_attr["fileNum"]),"时间日期"===e.item_type&&(t.type=e.item_type_attr.dateType?e.item_type_attr.dateType:"dateTime"),e.item_type){case"文本":t.type="textarea"===e.item_type_attr["view_model"]?"textarea":"input";break;case"图片":t.type="images";break;case"选项":t.type="radio";break}return"数字"===e.item_type&&(e.item_type_attr.numberType?t.type=e.item_type_attr.numberType:t.type="number"),"选项"===e.item_type&&(e.item_type_attr&&e.item_type_attr.radioType?"single"===e.item_type_attr.radioType?t.type="radio":"multi"===e.item_type_attr.radioType&&(t.type="checkbox"):t.type="radio"),t}}};t.default=s},d25d:function(e,t,i){"use strict";i.r(t);var a=i("b1d0"),n=i("1f96");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("6084");var s,l=i("f0c5"),u=Object(l["a"])(n["default"],a["b"],a["c"],!1,null,"3ee6a34e",null,!1,a["a"],s);t["default"]=u.exports},df45:function(e,t,i){var a=i("ef16");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("4f06").default;n("1bc87663",a,!0,{sourceMap:!1,shadowMode:!1})},ef16:function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.cu-modal.bottom-modal.show[data-v-3ee6a34e]{z-index:9999;overflow:hidden}.cu-modal.bottom-modal .cu-dialog[data-v-3ee6a34e]{overflow-y:scroll}.cu-modal-content[data-v-3ee6a34e]{height:100%}.cu-card.article>.cu-item .content .text-content[data-v-3ee6a34e]{height:auto}',""])}}]);